<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>EAFC Guide — FC26 Theme</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Poppins variable font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

<style>
  :root{
    /* FC26-like palette (from your 2nd image) */
    --bg0:#06131A;           /* deep blue-black */
    --bg1:#0A1D28;           /* card panel */
    --line:#133443;          /* subtle borders */
    --text:#EAF6FF;
    --muted:#9FBBCD;
    --chip:#0F2430;

    /* accent gradient: aqua -> lime with a hint of cyan */
    --g1:#22E4C6;
    --g2:#25B6FF;
    --g3:#9BFF53;

    --brand-grad: linear-gradient(135deg, var(--g2), var(--g1));
    --brand-grad-2: linear-gradient(135deg, var(--g2), var(--g3));

    --radius:18px;
    --shadow:0 12px 26px rgba(0,0,0,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    font-variation-settings: "wght" 475;
    /* FC26 blurred waves background */
    background:
      radial-gradient(1000px 700px at 15% -10%, rgba(37,182,255,.18), transparent 50%),
      radial-gradient(900px 600px at 90% 0%, rgba(34,228,198,.16), transparent 50%),
      radial-gradient(1200px 900px at 60% 110%, rgba(155,255,83,.08), transparent 60%),
      var(--bg0);
  }

  /* Header */
  header{
    position:sticky; top:0; z-index:30;
    backdrop-filter:saturate(1.1) blur(10px);
    background:linear-gradient(180deg, rgba(6,19,26,.92), rgba(6,19,26,.70));
    border-bottom:1px solid var(--line);
  }
  .wrap{max-width:1200px; margin:0 auto; padding:12px 16px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

  h1{margin:0; font-size:18px; display:flex; align-items:center; gap:10px}
  .logo{
    width:30px; height:30px; display:grid; place-items:center; border-radius:9px;
    background:var(--brand-grad-2); color:#021118; font-weight:900; box-shadow:var(--shadow)
  }

  .search{
    flex:1 1 280px; min-width:180px; display:flex; align-items:center; gap:8px;
    background:var(--bg1); padding:10px 12px; border:1px solid var(--line); border-radius:12px
  }
  .search input{width:100%; background:transparent; border:0; color:var(--text); outline:none; font-size:14px}

  .seg{
    display:flex; gap:6px; background:var(--bg1); padding:4px; border:1px solid var(--line);
    border-radius:12px
  }
  .seg button{
    padding:8px 12px; border-radius:10px; color:var(--muted); cursor:pointer; background:transparent; border:0;
    font-weight:600
  }
  .seg button.active{background:var(--brand-grad); color:#04131A}

  .iconbtn,.pill,.x{
    all:unset; cursor:pointer; user-select:none;
    display:inline-grid; place-items:center; padding:8px 10px; border-radius:12px;
    background:var(--chip); border:1px solid var(--line); color:var(--text)
  }
  .pill{padding:8px 12px; color:var(--muted)}
  .pill.active{background:var(--brand-grad); color:#04131A; border-color:transparent; font-weight:800}
  .muted{color:var(--muted)}

  main{max-width:1200px; margin:16px auto; padding:0 16px}

  /* Home: pillbar + grid */
  .pillbar{display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 12px}
  .grid{display:grid; gap:14px}
  @media (min-width:420px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (min-width:780px){ .grid{grid-template-columns:repeat(3,1fr)} }
  @media (min-width:1100px){ .grid{grid-template-columns:repeat(4,1fr)} }

  /* Player Card — cleaner layout */
  .card{
    position:relative; border:1px solid var(--line); border-radius:16px; background:rgba(10,29,40,.92);
    box-shadow:var(--shadow); overflow:hidden; padding:12px; display:grid; grid-template-columns:92px 1fr; gap:12px
  }
  .cardArt{
    position:relative; width:100%; height:120px; border-radius:12px; overflow:hidden;
    background:radial-gradient(160px 120px at 30% 0%, rgba(255,255,255,.12), transparent 45%), #131017;
    display:grid; place-items:center; border:1px solid rgba(255,255,255,.10)
  }
  /* frame image (user uploads) sits on top */
  .cardArt::before{
    content:""; position:absolute; inset:0; background-size:cover; background-position:center; background-repeat:no-repeat;
    opacity:.95; pointer-events:none; border-radius:12px;
    background-image: var(--frame-url, none);
  }
  .rating{
    position:relative; z-index:1;
    display:grid; place-items:center; width:64px; height:64px; border-radius:14px;
    background:var(--brand-grad-2); padding:3px; box-shadow:inset 0 0 0 2px rgba(255,255,255,.18)
  }
  .rating > b{
    display:grid; place-items:center; width:100%; height:100%; border-radius:10px;
    background:radial-gradient(120px 120px at 30% 10%, rgba(255,255,255,.18), transparent 40%), #0E0B11;
    font-size:22px; font-weight:900; letter-spacing:.5px
  }

  .meta .name{font-weight:800; font-size:16px; line-height:1.2}
  .poschip{
    display:inline-block; font-size:11px; padding:4px 8px; border-radius:999px;
    background:var(--chip); border:1px solid var(--line); margin-left:8px; color:var(--text); font-weight:700
  }
  .sub{font-size:12px; color:var(--muted); margin-top:2px}
  .rowm{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:6px}
  .chip{
    font-size:11px; padding:4px 8px; border-radius:999px; background:#0b1f29; border:1px solid var(--line);
    color:#CFEAFA
  }
  .ago{margin-left:auto; color:var(--muted); font-size:11px}

  /* Database (kept, but tone-matched) */
  .layout{display:grid; grid-template-columns:280px 1fr; gap:16px}
  @media (max-width:960px){ .layout{grid-template-columns:1fr} }
  .panel{background:rgba(10,29,40,.92); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow)}
  .filters{padding:14px}
  .filters h2{margin:0 0 10px 0; font-size:13px; color:var(--muted); letter-spacing:.6px; text-transform:uppercase}
  .field label{display:block; font-size:12px; color:var(--muted); margin:6px 2px}
  .field select,.field input[type="number"],.field input[type="range"]{
    width:100%; padding:12px; border-radius:12px; background:var(--bg1); color:var(--text); border:1px solid var(--line); min-height:44px}
  .range-row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .toolbar{display:flex; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid var(--line); flex-wrap:wrap}
  .toolbar .spacer{flex:1}
  .table-wrap{overflow:auto}
  table{width:100%; border-collapse:separate; border-spacing:0; min-width:920px}
  thead th{
    position:sticky; top:0; background:linear-gradient(180deg, rgba(10,29,40,1), rgba(10,29,40,.95));
    border-bottom:1px solid var(--line); font-size:12px; color:var(--muted); text-align:left; padding:10px; white-space:nowrap
  }
  tbody td{padding:12px 10px; border-bottom:1px solid var(--line); font-size:14px}
  th.sortable{cursor:pointer}
  .statbar{height:8px; background:#0c1f2a; border:1px solid var(--line); border-radius:999px; overflow:hidden}
  .statbar>i{display:block; height:100%; background:linear-gradient(90deg,var(--g1),var(--g2)); width:0%}

  @media (max-width:720px){
    table{min-width:0}
    thead{display:none}
    tbody,tr,td{display:block;width:100%}
    tbody tr{border:1px solid var(--line); border-radius:14px; margin:10px 0; background:rgba(10,29,40,.92); box-shadow:var(--shadow)}
    tbody td{display:grid; grid-template-columns:120px 1fr; gap:10px; padding:10px 12px; border-bottom:1px solid var(--line)}
    tbody td:last-child{border-bottom:none}
    tbody td::before{content:attr(data-col); color:var(--muted); font-size:12px; align-self:center}
  }

  /* Modal */
  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); backdrop-filter:blur(6px); z-index:40}
  .modal.open{display:grid}
  .card-modal{width:min(680px,92vw); background:var(--bg1); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow)}
  .card-modal header .wrap{display:flex; align-items:center; justify-content:space-between}
</style>
</head>
<body>
<header>
  <div class="wrap row">
    <h1><span class="logo">FC</span> EAFC Guide</h1>

    <div class="search" role="search" style="flex:1">
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 18a8 8 0 1 1 5.292-14.036A8 8 0 0 1 10 18m11.707 2.293l-5.387-5.387A9.956 9.956 0 0 0 20 10a10 10 0 1 0-10 10a9.956 9.956 0 0 0 4.906-1.68l5.387 5.387z"/></svg>
      <input id="globalSearch" placeholder="Search players…" inputmode="search" />
    </div>

    <nav class="seg" id="navTabs">
      <button class="active" data-view="home">Home</button>
      <button data-view="db">Database</button>
    </nav>

    <!-- Settings: upload a custom card frame -->
    <label class="iconbtn" title="Upload card frame (PNG/JPG)">
      <input id="frameUpload" type="file" accept="image/*" hidden />
      ⚙️
    </label>
  </div>
</header>

<main>
  <!-- HOME -->
  <section id="homeView">
    <div class="pillbar" id="homePills">
      <button class="pill active" data-filter="popular">Popular</button>
      <button class="pill" data-filter="new">New Release</button>
      <button class="pill" data-filter="promo">Latest Promo</button>
      <button class="pill" data-filter="rating">Highest Rated</button>
      <button class="pill" data-filter="sm5">5★ Skill</button>
      <button class="pill" data-filter="wf5">5★ Weak Foot</button>
    </div>
    <div class="grid" id="releaseGrid"></div>
  </section>

  <!-- DATABASE -->
  <section id="dbView" style="display:none">
    <div class="layout">
      <aside class="panel filters" aria-label="Filters">
        <h2>Filters</h2>
        <div class="field"><label for="club">Club</label><select id="club"><option value="">Any</option></select></div>
        <div class="field"><label for="nation">Nation</label><select id="nation"><option value="">Any</option></select></div>
        <div class="field"><label for="pos">Position</label>
          <select id="pos">
            <option value="">Any</option>
            <option>GK</option><option>CB</option><option>LB</option><option>RB</option>
            <option>CDM</option><option>CM</option><option>CAM</option>
            <option>LM</option><option>RM</option><option>LW</option><option>RW</option>
            <option>CF</option><option>ST</option>
          </select>
        </div>
        <div class="field">
          <label>Overall (OVR) range</label>
          <div class="range-row">
            <input id="ovrMin" type="number" min="1" max="99" value="1" />
            <input id="ovrMax" type="number" min="1" max="99" value="99" />
          </div>
        </div>
        <div class="field"><label for="paceMin">Min Pace (PAC)</label><input id="paceMin" type="range" min="1" max="99" value="1" /></div>
        <div class="field"><label for="smMin">Min Skill Moves</label><select id="smMin"><option value="1">Any</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
        <div class="field"><label for="wfMin">Min Weak Foot</label><select id="wfMin"><option value="1">Any</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
      </aside>

      <section class="panel">
        <div class="toolbar">
          <div id="countPill" class="pill">0 players</div>
          <div class="spacer"></div>
          <small class="muted">Tap a header to sort • Tap a row for details</small>
        </div>
        <div class="table-wrap">
          <table id="tbl">
            <thead>
              <tr>
                <th class="sortable" data-key="name">Player</th>
                <th class="sortable" data-key="position">Pos</th>
                <th class="sortable" data-key="club">Club</th>
                <th class="sortable" data-key="nation">Nation</th>
                <th class="sortable" data-key="overall">OVR</th>
                <th class="sortable" data-key="pace">PAC</th>
                <th class="sortable" data-key="shooting">SHO</th>
                <th class="sortable" data-key="passing">PAS</th>
                <th class="sortable" data-key="dribbling">DRI</th>
                <th class="sortable" data-key="defending">DEF</th>
                <th class="sortable" data-key="physical">PHY</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
        <div class="toolbar" id="pager"></div>
      </section>
    </div>
  </section>
</main>

<!-- Modal -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="card-modal">
    <header>
      <div class="wrap" style="padding:12px 14px">
        <h3 style="margin:0; font-weight:800">Player Details</h3>
        <button class="x" id="closeModal" aria-label="Close">✕</button>
      </div>
    </header>
    <div class="wrap" id="modalBody" style="padding:16px"></div>
  </div>
</div>

<script>
/* ======== DEMO DATA (replace with live feed later) ======== */
const releases = [
  {id:112, rating:99, name:"Ronaldinho", pos:"LW", club:"Icons", nation:"Brazil", promo:"Icon Moments", sm:5, wf:5, releasedAt:daysAgo(7), pop:99},
  {id:101, rating:98, name:"Bakayoko", pos:"RW", club:"PSV", nation:"Belgium", promo:"Festival", sm:5, wf:5, releasedAt:daysAgo(0.3), pop:95},
  {id:102, rating:98, name:"Noa Lang", pos:"LW", club:"PSV", nation:"Netherlands", promo:"Festival", sm:5, wf:5, releasedAt:daysAgo(1), pop:91},
  {id:103, rating:98, name:"Luis Díaz", pos:"LW", club:"Liverpool", nation:"Colombia", promo:"Festival", sm:5, wf:5, releasedAt:daysAgo(2), pop:96},
  {id:104, rating:98, name:"Justin Kluivert", pos:"ST", club:"Bournemouth", nation:"Netherlands", promo:"Festival", sm:5, wf:5, releasedAt:daysAgo(2), pop:89},
  {id:105, rating:98, name:"Cherki", pos:"CAM", club:"Lyon", nation:"France", promo:"Festival", sm:5, wf:5, releasedAt:daysAgo(3), pop:92}
];

const players = releases.map(r => ({
  id:r.id, name:r.name, position:r.pos, club:r.club, nation:r.nation,
  overall:r.rating, pace:90, shooting:88, passing:87, dribbling:93, defending:50, physical:80,
  skillMoves:r.sm, weakFoot:r.wf, workRate:"High/Medium", foot:"Right", age:"—", height:"—", weight:"—"
}));

/* ======== STATE ======== */
let state = {
  view:"home",
  homeFilter:"rating",
  q:"",
  // db filters
  club:"", nation:"", pos:"", ovrMin:1, ovrMax:99, paceMin:1, smMin:1, wfMin:1,
  sortKey:"overall", sortDir:"desc",
  page:1, rowsPerPage:25,
  data:[...players], filtered:[]
};

/* ======== HELPERS ======== */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
function daysAgo(d){ const t=new Date(); t.setTime(t.getTime()-d*24*3600*1000); return t.toISOString(); }
function esc(s){return String(s??"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]))}
function timeAgo(iso){ const sec=(Date.now()-new Date(iso).getTime())/1000; const d=Math.floor(sec/86400), h=Math.floor((sec%86400)/3600); if(d>=1) return d+" days ago"; if(h>=1) return h+" hours ago"; return "Just now"; }
function clamp(n,a,b){return Math.max(a,Math.min(b,n))}

/* ======== FRAME UPLOAD (custom card art frame) ======== */
const frameKey="eafc_frame_url";
const saved = localStorage.getItem(frameKey);
if(saved){ document.documentElement.style.setProperty('--frame-url', `url("${saved}")`); }
$("#frameUpload").addEventListener("change", (ev)=>{
  const f=ev.target.files?.[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=()=>{ const data=reader.result; localStorage.setItem(frameKey, data); document.documentElement.style.setProperty('--frame-url', `url("${data}")`); };
  reader.readAsDataURL(f);
});

/* ======== NAV ======== */
$("#navTabs").addEventListener("click",(e)=>{
  const b=e.target.closest("button"); if(!b) return;
  $$("#navTabs button").forEach(t=>t.classList.remove("active")); b.classList.add("active");
  state.view=b.dataset.view;
  $("#homeView").style.display= state.view==="home"?"block":"none";
  $("#dbView").style.display  = state.view==="db"  ?"block":"none";
});

/* ======== GLOBAL SEARCH ======== */
$("#globalSearch").addEventListener("input", e=>{
  state.q = e.target.value.trim().toLowerCase();
  if(state.view==="home") renderHome();
  else { state.page=1; applyDbFilters(); renderDb(); }
});

/* ======== HOME ======== */
$("#homePills").addEventListener("click",(e)=>{
  const p=e.target.closest(".pill"); if(!p) return;
  $$("#homePills .pill").forEach(x=>x.classList.remove("active")); p.classList.add("active");
  state.homeFilter=p.dataset.filter; renderHome();
});
function homeFilterFn(r){
  const hay=(r.name+" "+r.club+" "+r.nation+" "+r.promo).toLowerCase();
  if(state.q && !hay.includes(state.q)) return false;
  switch(state.homeFilter){
    case "popular": return true;
    case "new": return true;
    case "promo": return /promo|festival|icon/i.test(r.promo);
    case "rating": return true;
    case "sm5": return r.sm>=5;
    case "wf5": return r.wf>=5;
    default: return true;
  }
}
function homeSort(a,b){
  if(state.homeFilter==="popular") return (b.pop||0)-(a.pop||0);
  if(state.homeFilter==="new")     return new Date(b.releasedAt)-new Date(a.releasedAt);
  if(state.homeFilter==="rating")  return (b.rating||0)-(a.rating||0);
  return new Date(b.releasedAt)-new Date(a.releasedAt);
}
function renderHome(){
  const grid=$("#releaseGrid");
  const items=releases.filter(homeFilterFn).sort(homeSort);
  grid.innerHTML = items.map(r=>`
    <article class="card" role="button" aria-label="${esc(r.name)}" data-id="${r.id}">
      <div class="cardArt">
        <div class="rating"><b>${r.rating}</b></div>
      </div>
      <div class="meta">
        <div class="name">${esc(r.name)} <span class="poschip">${esc(r.pos)}</span></div>
        <div class="sub">${esc(r.club)} • ${esc(r.nation)}</div>
        <div class="rowm">
          <span class="chip">R: ${esc(r.promo)}</span>
          <span class="chip">SM ${r.sm}★ • WF ${r.wf}★</span>
          <span class="ago">${esc(timeAgo(r.releasedAt))}</span>
        </div>
      </div>
    </article>
  `).join("");

  $$("#releaseGrid .card").forEach(card=>{
    card.addEventListener("click", ()=>{
      const id = +card.dataset.id;
      const p = players.find(x=>x.id===id);
      openModal(p);
    });
  });
}

/* ======== DATABASE ======== */
function initDb(){
  fillSelect("#club", [...new Set(players.map(p=>p.club))].filter(Boolean));
  fillSelect("#nation", [...new Set(players.map(p=>p.nation))].filter(Boolean));
  $("#club").addEventListener("change", e=>{ state.club=e.target.value; state.page=1; applyDbFilters(); renderDb(); });
  $("#nation").addEventListener("change", e=>{ state.nation=e.target.value; state.page=1; applyDbFilters(); renderDb(); });
  $("#pos").addEventListener("change", e=>{ state.pos=e.target.value; state.page=1; applyDbFilters(); renderDb(); });
  $("#ovrMin").addEventListener("input", e=>{ state.ovrMin=+e.target.value||1; clampOvr(); applyDbFilters(); renderDb(); });
  $("#ovrMax").addEventListener("input", e=>{ state.ovrMax=+e.target.value||99; clampOvr(); applyDbFilters(); renderDb(); });
  $("#paceMin").addEventListener("input", e=>{ state.paceMin=+e.target.value||1; state.page=1; applyDbFilters(); renderDb(); });
  $("#smMin").addEventListener("change", e=>{ state.smMin=+e.target.value||1; state.page=1; applyDbFilters(); renderDb(); });
  $("#wfMin").addEventListener("change", e=>{ state.wfMin=+e.target.value||1; state.page=1; applyDbFilters(); renderDb(); });

  $("#tbl thead").addEventListener("click", e=>{
    const th=e.target.closest("th.sortable"); if(!th) return;
    const k=th.dataset.key;
    if(state.sortKey===k) state.sortDir = state.sortDir==="asc"?"desc":"asc";
    else { state.sortKey=k; state.sortDir="desc"; }
    renderDb();
  });

  applyDbFilters(); renderDb();
}
function fillSelect(sel, opts){
  const el=$(sel); (opts||[]).sort((a,b)=>a.localeCompare(b)).forEach(o=>{
    const op=document.createElement("option"); op.textContent=o; el.appendChild(op);
  });
}
function clampOvr(){ if(state.ovrMin>state.ovrMax){ const t=state.ovrMin; state.ovrMin=state.ovrMax; state.ovrMax=t; } }
function matches(p){
  const hay=(p.name+" "+p.club+" "+p.nation).toLowerCase();
  if(state.q && !hay.includes(state.q)) return false;
  if(state.club && p.club!==state.club) return false;
  if(state.nation && p.nation!==state.nation) return false;
  if(state.pos && p.position!==state.pos) return false;
  if((+p.overall||0)<state.ovrMin || (+p.overall||0)>state.ovrMax) return false;
  if((+p.pace||0)<state.paceMin) return false;
  if((+p.skillMoves||0)<state.smMin) return false;
  if((+p.weakFoot||0)<state.wfMin) return false;
  return true;
}
function applyDbFilters(){
  state.filtered = players.filter(matches);
  const dir = state.sortDir==="asc"?1:-1, k=state.sortKey;
  state.filtered.sort((a,b)=>{
    const va=a[k]??"", vb=b[k]??"";
    if(typeof va === "number" && typeof vb === "number") return (va-vb)*dir;
    return String(va).localeCompare(String(vb))*dir;
  });
}
function renderDb(){
  $("#countPill").textContent = `${state.filtered.length} players`;
  const tbody=$("#tbody"); const pager=$("#pager");
  const rpp=25, total=state.filtered.length, pages=Math.max(1,Math.ceil(total/rpp));
  if(state.page>pages) state.page=pages;
  const start=(state.page-1)*rpp;
  const pageSlice=state.filtered.slice(start,start+rpp);

  tbody.innerHTML = pageSlice.map(p=>`
    <tr data-id="${p.id}">
      <td data-col="Player"><b>${esc(p.name)}</b> <span class="poschip">${esc(p.position)}</span></td>
      <td data-col="Pos">${esc(p.position)}</td>
      <td data-col="Club">${esc(p.club)}</td>
      <td data-col="Nation">${esc(p.nation)}</td>
      <td data-col="OVR"><b>${p.overall}</b></td>
      <td data-col="PAC">${stat(p.pace)}</td>
      <td data-col="SHO">${stat(p.shooting)}</td>
      <td data-col="PAS">${stat(p.passing)}</td>
      <td data-col="DRI">${stat(p.dribbling)}</td>
      <td data-col="DEF">${stat(p.defending)}</td>
      <td data-col="PHY">${stat(p.physical)}</td>
    </tr>
  `).join("");

  pager.innerHTML = `
    <button class="iconbtn" ${state.page===1?"disabled":""} data-act="prev">Prev</button>
    <span class="muted">Page ${state.page} of ${pages}</span>
    <button class="iconbtn" ${state.page===pages?"disabled":""} data-act="next">Next</button>
  `;
  pager.onclick = e=>{
    const act = e.target.dataset.act;
    if(act==="prev" && state.page>1){ state.page--; renderDb(); }
    if(act==="next" && state.page<pages){ state.page++; renderDb(); }
  };
  $$("#tbody tr").forEach(tr=>{
    tr.addEventListener("click", ()=>{
      const id=+tr.dataset.id;
      const p=players.find(x=>x.id===id);
      openModal(p);
    });
  });
}
function stat(v){ const val=clamp(+v||0,1,99); return `<div class="statbar" aria-label="${val}"><i style="width:${val}%"></i></div>`; }

/* ======== MODAL ======== */
function openModal(p){
  const el=$("#modalBody");
  el.innerHTML = `
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px">
      <div>
        <div style="display:flex; align-items:center; gap:8px">
          <h3 style="margin:0; font-weight:800">${esc(p.name)}</h3>
          <span class="poschip">${esc(p.position)}</span>
        </div>
        <div class="muted">${esc(p.club)} • ${esc(p.nation)}</div>
        <div style="margin:10px 0; display:grid; grid-template-columns:1fr 1fr; gap:8px">
          ${detailStat("Overall", p.overall)}
          ${detailStat("Pace", p.pace)}
          ${detailStat("Shooting", p.shooting)}
          ${detailStat("Passing", p.passing)}
          ${detailStat("Dribbling", p.dribbling)}
          ${detailStat("Defending", p.defending)}
          ${detailStat("Physical", p.physical)}
        </div>
      </div>
      <div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px">
          ${fact("Skill Moves", p.skillMoves+"★")}
          ${fact("Weak Foot", p.weakFoot+"★")}
          ${fact("Work Rate", p.workRate)}
          ${fact("Preferred Foot", p.foot)}
        </div>
      </div>
    </div>`;
  $("#modal").classList.add("open"); $("#modal").setAttribute("aria-hidden","false");
}
$("#closeModal").addEventListener("click", closeModal);
$("#modal").addEventListener("click", e=>{ if(e.target.id==="modal") closeModal(); });
function closeModal(){ $("#modal").classList.remove("open"); $("#modal").setAttribute("aria-hidden","true"); }
function detailStat(label, val){ val=clamp(+val||0,1,99); return `<div><div class="muted" style="font-size:12px">${esc(label)}</div><div style="display:flex; align-items:center; gap:8px"><b>${val}</b><div class="statbar" style="flex:1"><i style="width:${val}%"></i></div></div></div>`; }
function fact(label, val){ return `<div><div class="muted" style="font-size:12px">${esc(label)}</div><div>${esc(val??"-")}</div></div>`; }

/* ======== BOOT ======== */
renderHome(); initDb();

/* utils used above */
function fillSelect(sel, opts){ const el=$(sel); (opts||[]).sort((a,b)=>a.localeCompare(b)).forEach(o=>{ const op=document.createElement("option"); op.textContent=o; el.appendChild(op); }); }
</script>
</body>
</html>
