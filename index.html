<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EAFC Database — Single-File Web App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0d11; --panel:#12161d; --muted:#8a94a7; --text:#e7ecf3;
      --brand:#5ad7ff; --brand-2:#8b5cff; --ok:#3ddc97; --warn:#ffb020; --bad:#ff5a7a;
      --line:#202735; --chip:#1a2030; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 600px at 10% -10%, rgba(90,215,255,.12), transparent 50%),
              radial-gradient(900px 600px at 100% 0%, rgba(139,92,255,.12), transparent 50%),
              var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px);
      background:linear-gradient(180deg, rgba(11,13,17,.9), rgba(11,13,17,.75));
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:18px 20px}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    h1{margin:0; font-size:20px; letter-spacing:.4px; display:flex; align-items:center; gap:10px}
    .logo{
      width:28px; height:28px; display:grid; place-items:center; border-radius:8px;
      background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:#001018; font-weight:900;
      box-shadow: var(--shadow);
    }
    .search{
      flex:1 1 260px; min-width:220px; display:flex; align-items:center; gap:8px;
      background:var(--panel); padding:10px 12px; border:1px solid var(--line); border-radius:12px;
    }
    .search input{
      width:100%; background:transparent; border:0; color:var(--text); outline:none; font-size:14px;
    }
    .btn{
      appearance:none; border:1px solid var(--line); background:var(--chip); color:var(--text);
      padding:10px 12px; border-radius:12px; font-weight:600; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn.primary{background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:#07121a; border-color:transparent}
    .btn.ghost{background:transparent}
    .pill{padding:8px 10px; border:1px dashed var(--line); border-radius:999px; color:var(--muted); font-size:12px}
    main{max-width:1200px; margin:16px auto; display:grid; grid-template-columns:280px 1fr; gap:16px; padding:0 20px}
    @media (max-width: 980px){ main{grid-template-columns:1fr} .filters{order:2} }
    .panel{
      background:rgba(18,22,29,.9); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
    }
    .filters{padding:14px}
    .filters h2{margin:0 0 10px 0; font-size:14px; color:var(--muted); letter-spacing:.6px; text-transform:uppercase}
    .grid{display:grid; gap:10px}
    .field label{display:block; font-size:12px; color:var(--muted); margin:6px 2px}
    .field select, .field input[type="number"], .field input[type="text"], .field input[type="range"]{
      width:100%; padding:10px; border-radius:10px; background:var(--panel); color:var(--text); border:1px solid var(--line);
    }
    .range-row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{background:var(--chip); border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted)}
    .table-wrap{overflow:auto}
    table{width:100%; border-collapse:separate; border-spacing:0; min-width:920px}
    thead th{
      position:sticky; top:0; background:linear-gradient(180deg, rgba(18,22,29,1), rgba(18,22,29,.95));
      border-bottom:1px solid var(--line); font-size:12px; color:var(--muted); text-align:left; padding:10px; white-space:nowrap;
      backdrop-filter: blur(6px);
    }
    tbody td{padding:12px 10px; border-bottom:1px solid var(--line); font-size:14px}
    tbody tr:hover{background:rgba(138,148,167,.06)}
    th.sortable{cursor:pointer}
    th.sortable .arrow{opacity:.35; margin-left:6px}
    .tag{font-size:12px; padding:4px 8px; border-radius:999px; background:rgba(90,215,255,.12); border:1px solid rgba(90,215,255,.3); color:#cdefff}
    .badge{font-weight:800; padding:6px 10px; border-radius:10px; background:#0d131c; border:1px solid var(--line)}
    .statbar{
      height:8px; background:#10151e; border:1px solid var(--line); border-radius:999px; overflow:hidden;
    }
    .statbar > i{display:block; height:100%; background:linear-gradient(90deg, var(--ok), var(--brand)); width:0%}
    .row-top{display:flex; align-items:center; gap:10px}
    .row-name{font-weight:700}
    .muted{color:var(--muted)}
    .toolbar{display:flex; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid var(--line)}
    .toolbar .spacer{flex:1}
    .pagination{display:flex; gap:6px; align-items:center; padding:10px 12px}
    .page-btn{padding:8px 10px; border-radius:10px; border:1px solid var(--line); background:var(--chip); cursor:pointer}
    .page-btn[disabled]{opacity:.4; cursor:not-allowed}
    .modal{
      position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); backdrop-filter: blur(4px);
    }
    .modal.open{display:grid}
    .card{
      width:min(680px, 92vw); background:var(--panel); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow);
    }
    .card header{position:relative}
    .card header .wrap{display:flex; align-items:center; justify-content:space-between}
    .x{all:unset; cursor:pointer; font-weight:900; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:var(--chip)}
    .card-body{padding:16px}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width:700px){.grid-2{grid-template-columns:1fr}}
    .note{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <h1><span class="logo">FC</span> EAFC Database</h1>
      <div class="search" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 18a8 8 0 1 1 5.292-14.036A8 8 0 0 1 10 18m11.707 2.293l-5.387-5.387A9.956 9.956 0 0 0 20 10a10 10 0 1 0-10 10a9.956 9.956 0 0 0 4.906-1.68l5.387 5.387z"/></svg>
        <input id="q" placeholder="Search name / club / nation…" />
      </div>
      <button class="btn ghost" id="clearBtn" title="Reset all filters">Clear</button>
      <label class="btn">
        Import JSON
        <input type="file" id="fileInput" accept=".json" hidden />
      </label>
      <button class="btn" id="exportBtn">Export CSV</button>
      <span class="pill" id="countPill">0 players</span>
    </div>
  </header>

  <main>
    <aside class="panel filters">
      <h2>Filters</h2>
      <div class="grid">
        <div class="field">
          <label for="club">Club</label>
          <select id="club"><option value="">Any</option></select>
        </div>
        <div class="field">
          <label for="nation">Nation</label>
          <select id="nation"><option value="">Any</option></select>
        </div>
        <div class="field">
          <label for="pos">Position</label>
          <select id="pos">
            <option value="">Any</option>
            <option>GK</option><option>CB</option><option>LB</option><option>RB</option>
            <option>CDM</option><option>CM</option><option>CAM</option>
            <option>LM</option><option>RM</option><option>LW</option><option>RW</option>
            <option>CF</option><option>ST</option>
          </select>
        </div>
        <div class="field">
          <label>Overall (OVR) range</label>
          <div class="range-row">
            <input id="ovrMin" type="number" min="1" max="99" value="1" />
            <input id="ovrMax" type="number" min="1" max="99" value="99" />
          </div>
        </div>
        <div class="field">
          <label for="paceMin">Min Pace (PAC)</label>
          <input id="paceMin" type="range" min="1" max="99" value="1" />
          <div class="chips"><span class="chip"><span id="paceVal">1</span></span></div>
        </div>
        <div class="field">
          <label for="smMin">Min Skill Moves</label>
          <select id="smMin"><option value="1">Any</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
        </div>
        <div class="field">
          <label for="wfMin">Min Weak Foot</label>
          <select id="wfMin"><option value="1">Any</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
        </div>
        <div class="field">
          <label for="rowsPerPage">Rows per page</label>
          <select id="rowsPerPage"><option>10</option><option selected>25</option><option>50</option><option>100</option></select>
        </div>
      </div>
    </aside>

    <section class="panel">
      <div class="toolbar">
        <div class="chips" id="activeChips"></div>
        <div class="spacer"></div>
        <small class="note">Click a header to sort • Click a row for details</small>
      </div>
      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th class="sortable" data-key="name">Player <span class="arrow">↕</span></th>
              <th class="sortable" data-key="position">Pos <span class="arrow">↕</span></th>
              <th class="sortable" data-key="club">Club <span class="arrow">↕</span></th>
              <th class="sortable" data-key="nation">Nation <span class="arrow">↕</span></th>
              <th class="sortable" data-key="overall">OVR <span class="arrow">↕</span></th>
              <th class="sortable" data-key="pace">PAC <span class="arrow">↕</span></th>
              <th class="sortable" data-key="shooting">SHO <span class="arrow">↕</span></th>
              <th class="sortable" data-key="passing">PAS <span class="arrow">↕</span></th>
              <th class="sortable" data-key="dribbling">DRI <span class="arrow">↕</span></th>
              <th class="sortable" data-key="defending">DEF <span class="arrow">↕</span></th>
              <th class="sortable" data-key="physical">PHY <span class="arrow">↕</span></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="pagination" id="pager"></div>
    </section>
  </main>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="card">
      <header>
        <div class="wrap">
          <h3 style="margin:0; font-size:18px">Player Details</h3>
          <button class="x" id="closeModal" aria-label="Close">✕</button>
        </div>
      </header>
      <div class="card-body" id="modalBody"></div>
    </div>
  </div>

  <script>
  // ======== SAMPLE DATA (replace or import JSON) ========
  let players = [
    {id:1, name:"Kylian Mbappé", position:"ST", club:"Real Madrid", nation:"France", overall:92, pace:97, shooting:91, passing:82, dribbling:93, defending:39, physical:79, skillMoves:5, weakFoot:4, workRate:"High/Low", age:26, height:"178 cm", weight:"73 kg", foot:"Right"},
    {id:2, name:"Erling Haaland", position:"ST", club:"Manchester City", nation:"Norway", overall:92, pace:89, shooting:95, passing:75, dribbling:82, defending:45, physical:93, skillMoves:3, weakFoot:4, workRate:"High/Medium", age:25, height:"195 cm", weight:"94 kg", foot:"Left"},
    {id:3, name:"Kevin De Bruyne", position:"CAM", club:"Manchester City", nation:"Belgium", overall:91, pace:74, shooting:88, passing:94, dribbling:87, defending:64, physical:78, skillMoves:4, weakFoot:5, workRate:"High/High", age:34, height:"181 cm", weight:"68 kg", foot:"Right"},
    {id:4, name:"Jude Bellingham", position:"CM", club:"Real Madrid", nation:"England", overall:91, pace:82, shooting:86, passing:86, dribbling:88, defending:78, physical:84, skillMoves:4, weakFoot:4, workRate:"High/High", age:22, height:"186 cm", weight:"75 kg", foot:"Right"},
    {id:5, name:"Lionel Messi", position:"RW", club:"Inter Miami", nation:"Argentina", overall:90, pace:75, shooting:90, passing:92, dribbling:94, defending:34, physical:65, skillMoves:4, weakFoot:4, workRate:"Low/Low", age:38, height:"170 cm", weight:"72 kg", foot:"Left"},
    {id:6, name:"Vinícius Jr.", position:"LW", club:"Real Madrid", nation:"Brazil", overall:90, pace:95, shooting:85, passing:79, dribbling:92, defending:35, physical:72, skillMoves:5, weakFoot:4, workRate:"High/Medium", age:25, height:"176 cm", weight:"73 kg", foot:"Right"},
    {id:7, name:"Mohamed Salah", position:"RW", club:"Liverpool", nation:"Egypt", overall:89, pace:89, shooting:90, passing:82, dribbling:90, defending:45, physical:76, skillMoves:4, weakFoot:3, workRate:"High/Medium", age:33, height:"175 cm", weight:"71 kg", foot:"Left"},
    {id:8, name:"Karim Benzema", position:"CF", club:"Al-Ittihad", nation:"France", overall:88, pace:76, shooting:90, passing:83, dribbling:88, defending:40, physical:79, skillMoves:4, weakFoot:4, workRate:"Medium/Low", age:37, height:"185 cm", weight:"81 kg", foot:"Right"},
    {id:9, name:"Rodri", position:"CDM", club:"Manchester City", nation:"Spain", overall:90, pace:66, shooting:84, passing:88, dribbling:82, defending:86, physical:84, skillMoves:3, weakFoot:4, workRate:"Medium/High", age:29, height:"191 cm", weight:"82 kg", foot:"Right"},
    {id:10, name:"Virgil van Dijk", position:"CB", club:"Liverpool", nation:"Netherlands", overall:89, pace:75, shooting:60, passing:71, dribbling:72, defending:90, physical:86, skillMoves:2, weakFoot:3, workRate:"Medium/High", age:34, height:"193 cm", weight:"92 kg", foot:"Right"},
    {id:11, name:"Pedri", position:"CM", club:"Barcelona", nation:"Spain", overall:88, pace:78, shooting:74, passing:87, dribbling:90, defending:67, physical:69, skillMoves:4, weakFoot:4, workRate:"High/High", age:22, height:"174 cm", weight:"60 kg", foot:"Right"},
    {id:12, name:"Jamal Musiala", position:"CAM", club:"Bayern Munich", nation:"Germany", overall:89, pace:87, shooting:82, passing:84, dribbling:93, defending:55, physical:68, skillMoves:5, weakFoot:4, workRate:"High/Medium", age:22, height:"184 cm", weight:"70 kg", foot:"Right"},
    {id:13, name:"Bukayo Saka", position:"RW", club:"Arsenal", nation:"England", overall:88, pace:86, shooting:85, passing:84, dribbling:89, defending:60, physical:73, skillMoves:4, weakFoot:4, workRate:"High/Medium", age:23, height:"178 cm", weight:"72 kg", foot:"Left"},
    {id:14, name:"Harry Kane", position:"ST", club:"Bayern Munich", nation:"England", overall:91, pace:74, shooting:94, passing:86, dribbling:84, defending:48, physical:86, skillMoves:4, weakFoot:5, workRate:"High/High", age:32, height:"188 cm", weight:"86 kg", foot:"Right"},
    {id:15, name:"Thibaut Courtois", position:"GK", club:"Real Madrid", nation:"Belgium", overall:90, pace:55, shooting:25, passing:75, dribbling:45, defending:52, physical:80, skillMoves:1, weakFoot:3, workRate:"Medium/Medium", age:33, height:"200 cm", weight:"96 kg", foot:"Left"}
  ];

  // ======== STATE ========
  let state = {
    q: "", club:"", nation:"", pos:"",
    ovrMin:1, ovrMax:99, paceMin:1, smMin:1, wfMin:1,
    sortKey:"overall", sortDir:"desc",
    page:1, rowsPerPage:25,
    data:[...players], filtered:[]
  };

  // ======== ELEMENTS ========
  const $ = sel => document.querySelector(sel);
  const $$ = sel => document.querySelectorAll(sel);
  const tbody = $("#tbody"), thead = $("#tbl thead"), pager = $("#pager");
  const countPill = $("#countPill"), activeChips = $("#activeChips");

  // ======== INIT ========
  init();
  function init(){
    // Populate selects
    fillSelect("#club", unique(players.map(p=>p.club)));
    fillSelect("#nation", unique(players.map(p=>p.nation)));
    // Bind inputs
    bindInputs();
    // First render
    applyFilters();
    render();
  }

  function fillSelect(sel, opts){
    const el = $(sel);
    for(const o of opts.sort((a,b)=>a.localeCompare(b))) {
      const op = document.createElement("option"); op.textContent = o; el.appendChild(op);
    }
  }

  function bindInputs(){
    $("#q").addEventListener("input", e => { state.q = e.target.value.trim().toLowerCase(); state.page=1; renderFiltered(); });
    $("#club").addEventListener("change", e => { state.club = e.target.value; state.page=1; renderFiltered(); });
    $("#nation").addEventListener("change", e => { state.nation = e.target.value; state.page=1; renderFiltered(); });
    $("#pos").addEventListener("change", e => { state.pos = e.target.value; state.page=1; renderFiltered(); });
    $("#ovrMin").addEventListener("input", e => { state.ovrMin = +e.target.value||1; clampOVR(); renderFiltered(); });
    $("#ovrMax").addEventListener("input", e => { state.ovrMax = +e.target.value||99; clampOVR(); renderFiltered(); });
    $("#paceMin").addEventListener("input", e => { state.paceMin = +e.target.value; $("#paceVal").textContent = state.paceMin; state.page=1; renderFiltered(); });
    $("#smMin").addEventListener("change", e => { state.smMin = +e.target.value; state.page=1; renderFiltered(); });
    $("#wfMin").addEventListener("change", e => { state.wfMin = +e.target.value; state.page=1; renderFiltered(); });
    $("#rowsPerPage").addEventListener("change", e => { state.rowsPerPage = +e.target.value; state.page=1; render(); });
    $("#clearBtn").addEventListener("click", resetAll);
    $("#exportBtn").addEventListener("click", exportCSV);
    $("#fileInput").addEventListener("change", importJSON);
    $("#closeModal").addEventListener("click", closeModal);
    $("#modal").addEventListener("click", e => { if(e.target.id==="modal") closeModal(); });

    thead.addEventListener("click", e=>{
      const th = e.target.closest("th.sortable"); if(!th) return;
      const key = th.dataset.key;
      if(state.sortKey === key) state.sortDir = (state.sortDir==="asc"?"desc":"asc");
      else { state.sortKey = key; state.sortDir = "desc"; }
      render();
    });
  }

  function clampOVR(){
    if(state.ovrMin>state.ovrMax){ const t=state.ovrMin; state.ovrMin=state.ovrMax; state.ovrMax=t; }
    $("#ovrMin").value = state.ovrMin; $("#ovrMax").value = state.ovrMax;
  }

  // ======== FILTER / SORT / PAGINATE ========
  function matches(p){
    const hay = (p.name+" "+p.club+" "+p.nation).toLowerCase();
    if(state.q && !hay.includes(state.q)) return false;
    if(state.club && p.club !== state.club) return false;
    if(state.nation && p.nation !== state.nation) return false;
    if(state.pos && p.position !== state.pos) return false;
    if((+p.overall||0) < state.ovrMin || (+p.overall||0) > state.ovrMax) return false;
    if((+p.pace||0) < state.paceMin) return false;
    if((+p.skillMoves||0) < state.smMin) return false;
    if((+p.weakFoot||0) < state.wfMin) return false;
    return true;
  }

  function renderFiltered(){
    applyFilters();
    render();
  }

  function applyFilters(){
    state.filtered = state.data.filter(matches);
    // Sort
    const k = state.sortKey, dir = state.sortDir === "asc" ? 1 : -1;
    state.filtered.sort((a,b)=> {
      const va = (a[k]??""); const vb = (b[k]??"");
      if(typeof va === "number" && typeof vb === "number") return (va - vb) * dir;
      return String(va).localeCompare(String(vb)) * dir;
    });
  }

  function render(){
    countPill.textContent = `${state.filtered.length} players`;
    renderChips();
    // Pagination
    const total = state.filtered.length, rpp = state.rowsPerPage;
    const pages = Math.max(1, Math.ceil(total / rpp));
    if(state.page>pages) state.page = pages;
    const start = (state.page - 1) * rpp;
    const pageSlice = state.filtered.slice(start, start + rpp);
    // Rows
    tbody.innerHTML = pageSlice.map(rowHTML).join("");
    // Pager
    pager.innerHTML = `
      <button class="page-btn" ${state.page===1?"disabled":""} data-act="prev">Prev</button>
      <span class="muted">Page ${state.page} of ${pages}</span>
      <button class="page-btn" ${state.page===pages?"disabled":""} data-act="next">Next</button>
    `;
    pager.onclick = e=>{
      const act = e.target.dataset.act;
      if(act==="prev" && state.page>1){ state.page--; render(); }
      if(act==="next" && state.page<pages){ state.page++; render(); }
    }
    // Bind row clicks
    $$("#tbody tr").forEach(tr=>{
      tr.addEventListener("click", ()=>{
        const id = +tr.dataset.id;
        const p = state.filtered.find(x=>x.id===id);
        openModal(p);
      });
    });
  }

  function rowHTML(p){
    return `<tr data-id="${p.id}">
      <td>
        <div class="row-top"><span class="row-name">${esc(p.name)}</span> <span class="tag">${esc(p.workRate||"")}</span></div>
        <div class="muted" style="font-size:12px">SM ${p.skillMoves}★ • WF ${p.weakFoot}★ • ${esc(p.foot||"")}</div>
      </td>
      <td><span class="badge">${esc(p.position)}</span></td>
      <td>${esc(p.club)}</td>
      <td>${esc(p.nation)}</td>
      <td><b>${num(p.overall)}</b></td>
      <td>${stat(p.pace)}</td>
      <td>${stat(p.shooting)}</td>
      <td>${stat(p.passing)}</td>
      <td>${stat(p.dribbling)}</td>
      <td>${stat(p.defending)}</td>
      <td>${stat(p.physical)}</td>
    </tr>`;
  }

  function stat(v){
    const val = clamp(+v||0, 1, 99);
    return `<div class="statbar" aria-label="${val}"><i style="width:${val}%"></i></div>`;
  }

  function renderChips(){
    const chips = [];
    if(state.q) chips.push(ch("Search", state.q, ()=>{$("#q").value=""; state.q=""; renderFiltered();}));
    if(state.club) chips.push(ch("Club", state.club, ()=>{$("#club").value=""; state.club=""; renderFiltered();}));
    if(state.nation) chips.push(ch("Nation", state.nation, ()=>{$("#nation").value=""; state.nation=""; renderFiltered();}));
    if(state.pos) chips.push(ch("Pos", state.pos, ()=>{$("#pos").value=""; state.pos=""; renderFiltered();}));
    if(state.ovrMin>1 || state.ovrMax<99) chips.push(ch("OVR", `${state.ovrMin}–${state.ovrMax}`, ()=>{
      state.ovrMin=1; state.ovrMax=99; $("#ovrMin").value=1; $("#ovrMax").value=99; renderFiltered();
    }));
    if(state.paceMin>1) chips.push(ch("PAC ≥", state.paceMin, ()=>{
      state.paceMin=1; $("#paceMin").value=1; $("#paceVal").textContent='1'; renderFiltered();
    }));
    if(state.smMin>1) chips.push(ch("SM ≥", state.smMin, ()=>{$("#smMin").value="1"; state.smMin=1; renderFiltered();}));
    if(state.wfMin>1) chips.push(ch("WF ≥", state.wfMin, ()=>{$("#wfMin").value="1"; state.wfMin=1; renderFiltered();}));
    activeChips.innerHTML = chips.join("");
  }
  function ch(label, value, onClose){
    const id = "chip-"+Math.random().toString(36).slice(2);
    queueMicrotask(()=>{
      const x = document.getElementById(id);
      x?.addEventListener("click", onClose);
    });
    return `<span class="chip">${esc(label)}: ${esc(String(value))} <button id="${id}" class="x" style="border:none;padding:2px 6px; margin-left:6px">x</button></span>`;
  }

  // ======== MODAL ========
  function openModal(p){
    const el = $("#modalBody");
    el.innerHTML = `
      <div class="grid-2">
        <div>
          <h3 style="margin:0 0 4px 0">${esc(p.name)} <span class="badge">${esc(p.position)}</span></h3>
          <div class="muted">${esc(p.club)} • ${esc(p.nation)}</div>
          <div style="margin:10px 0; display:grid; grid-template-columns:1fr 1fr; gap:8px">
            ${detailStat("Overall", p.overall)}
            ${detailStat("Pace", p.pace)}
            ${detailStat("Shooting", p.shooting)}
            ${detailStat("Passing", p.passing)}
            ${detailStat("Dribbling", p.dribbling)}
            ${detailStat("Defending", p.defending)}
            ${detailStat("Physical", p.physical)}
          </div>
        </div>
        <div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px">
            ${fact("Skill Moves", p.skillMoves+"★")}
            ${fact("Weak Foot", p.weakFoot+"★")}
            ${fact("Work Rate", p.workRate)}
            ${fact("Preferred Foot", p.foot)}
            ${fact("Age", p.age)}
            ${fact("Height", p.height)}
            ${fact("Weight", p.weight)}
          </div>
        </div>
      </div>
      <p class="note" style="margin-top:12px">Tip: Use “Export CSV” to download the current filtered+sorted view. Import a JSON file with an array of players using the same keys as shown above.</p>
    `;
    $("#modal").classList.add("open");
    $("#modal").setAttribute("aria-hidden","false");
  }
  function closeModal(){
    $("#modal").classList.remove("open");
    $("#modal").setAttribute("aria-hidden","true");
  }
  function detailStat(label, val){
    val = clamp(+val||0,1,99);
    return `<div><div class="muted" style="font-size:12px">${esc(label)}</div>
      <div style="display:flex; align-items:center; gap:8px"><b>${val}</b>
      <div class="statbar" style="flex:1"><i style="width:${val}%"></i></div></div></div>`;
  }
  function fact(label, val){ return `<div><div class="muted" style="font-size:12px">${esc(label)}</div><div>${esc(val??"-")}</div></div>`; }

  // ======== IMPORT / EXPORT ========
  function importJSON(ev){
    const file = ev.target.files?.[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const arr = JSON.parse(reader.result);
        if(!Array.isArray(arr)) throw new Error("JSON root must be an array");
        // Basic normalization
        let idSeed = Date.now();
        players = arr.map((p,i)=>({
          id: p.id ?? (++idSeed),
          name: p.name ?? "Unknown",
          position: p.position ?? p.pos ?? "-",
          club: p.club ?? "-",
          nation: p.nation ?? "-",
          overall: toNum(p.overall ?? p.ovr),
          pace: toNum(p.pace ?? p.pac),
          shooting: toNum(p.shooting ?? p.sho),
          passing: toNum(p.passing ?? p.pas),
          dribbling: toNum(p.dribbling ?? p.dri),
          defending: toNum(p.defending ?? p.def),
          physical: toNum(p.physical ?? p.phy),
          skillMoves: toNum(p.skillMoves ?? p.sm ?? 1),
          weakFoot: toNum(p.weakFoot ?? p.wf ?? 1),
          workRate: p.workRate ?? p.work_rate ?? "",
          age: p.age ?? "", height: p.height ?? "", weight: p.weight ?? "", foot: p.foot ?? p.footed ?? ""
        }));
        state.data = [...players];
        // Refill selects with new values
        $("#club").innerHTML = '<option value="">Any</option>';
        $("#nation").innerHTML = '<option value="">Any</option>';
        fillSelect("#club", unique(players.map(p=>p.club)));
        fillSelect("#nation", unique(players.map(p=>p.nation)));
        resetAll(false);
      }catch(err){
        alert("Import failed: " + err.message);
      }
      ev.target.value = ""; // reset input
    };
    reader.readAsText(file);
  }

  function exportCSV(){
    const rows = state.filtered.slice((state.page-1)*state.rowsPerPage, (state.page-1)*state.rowsPerPage + state.rowsPerPage);
    const headers = ["Name","Position","Club","Nation","Overall","Pace","Shooting","Passing","Dribbling","Defending","Physical","SkillMoves","WeakFoot","WorkRate","Age","Height","Weight","Foot"];
    const csv = [headers.join(",")]
      .concat(rows.map(p=>[
        p.name, p.position, p.club, p.nation, p.overall, p.pace, p.shooting, p.passing, p.dribbling, p.defending, p.physical, p.skillMoves, p.weakFoot, p.workRate, p.age, p.height, p.weight, p.foot
      ].map(csvCell).join(",")))
      .join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = Object.assign(document.createElement("a"), {href:url, download:"eafc-database.csv"});
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // ======== UTIL ========
  function unique(arr){ return [...new Set(arr.filter(Boolean))]; }
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
  function num(x){ const n=+x||0; return n.toFixed(0); }
  function esc(s){ return String(s??"").replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m])); }
  function csvCell(s){
    s = s==null ? "" : String(s);
    if (/[",\n]/.test(s)) return `"${s.replace(/"/g,'""')}"`;
    return s;
  }
  function toNum(v){ const n = +v; return Number.isFinite(n) ? n : 0; }

  function resetAll(showAlert=true){
    state.q=""; $("#q").value="";
    state.club=""; $("#club").value="";
    state.nation=""; $("#nation").value="";
    state.pos=""; $("#pos").value="";
    state.ovrMin=1; state.ovrMax=99; $("#ovrMin").value=1; $("#ovrMax").value=99;
    state.paceMin=1; $("#paceMin").value=1; $("#paceVal").textContent="1";
    state.smMin=1; $("#smMin").value="1";
    state.wfMin=1; $("#wfMin").value="1";
    state.rowsPerPage=25; $("#rowsPerPage").value="25";
    state.page=1; state.sortKey="overall"; state.sortDir="desc";
    state.data=[...players];
    applyFilters(); render();
    if(showAlert) toast("Filters cleared");
  }

  function toast(msg){
    const t=document.createElement("div");
    t.textContent=msg; t.style.cssText = `
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#06111a;
      padding:10px 14px; border-radius:999px; font-weight:800; box-shadow:var(--shadow); z-index:9999`;
    document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 1400);
  }
  // ======== END ========
  </script>
</body>
</html>
